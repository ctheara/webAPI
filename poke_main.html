<html>
    <head>
        <style>
          #pastInfo {
              border: solid 1px blue;
       

          }

        </style>
    
      </head>
<body onload = "readFromLocalStorage();">

<h2>Pokemon Stats</h2>

<p></p>Using stats from PokeAPI</p>

<form onsubmit = 'save();'>
    <label for = 'name'>Pokemon Name: </label>
    <input id = 'name' type = 'text' required> <br>
    <br><br>
    <input type = "submit" value = "Submit" onclick="getInfo()"> 
    <input id = 'btnReset' type = "reset">
</form>

<p>
<button type="button" onclick="getInfo()">Get Info from PokeAPI</button>
<br><br>
<div id="info"></div>
</p>




<script>
var record;

//get info from API
function getInfo() {

    var xhttp = new XMLHttpRequest();

    //user pokemon input
    pokemonName = document.getElementById('name').value.trim().toLowerCase();

    // defining a function and assigning it to 'xhttp.onreadystatechange'.
    xhttp.onreadystatechange = function() {
        // if request is successful
        if (this.readyState == 4 && this.status == 200) {
            recordStr = this.responseText; // JSON format
            localStorage.setItem('pokemon', recordStr);

            record = JSON.parse(recordStr);

            //get stats for pokemon
            msg = "Name: " + record.name +"<br>";
            msg += "Height: " + record.height/10 + " meters<br>";
            msg += "Weight: " + record.weight/10 + " meters<br>"
            
            // for each ability, add its name to the string
            msg += "Abilities: ";
            for (var i = 0; i < record.abilities.length; i++) {
                msg += record.abilities[i].ability.name;
                if (i + 1 != record.abilities.length) {
                    msg += ", ";
                }
            }

            //list type stat
            msg += "<br>Type: ";
            for (var i = 0; i < record.types.length; i++) {
                msg += record.types[i].type.name;
                if (i + 1 != record.types.length) {
                    msg += ", ";
                }
            }

            //get image
            msg += '<br><img src="' + record.sprites.front_default+'">';

            // set the innerHTML of the "info" div
            document.getElementById("info").innerHTML = msg;
        }
    }

    // submit a 'get' request to the pokeapi; 'true' is used to make the request asynchronously
    xhttp.open("GET", "https://pokeapi.co/api/v2/pokemon/"+pokemonName, true);
    xhttp.send();
};


//Save info to local storage
function save() {
    var pName = document.getElementById('name').value.trim();

    if (pName == '') {
        return;
    }

    // create pokemon object
    var pokemon = {name: pName};

    // convert person to JSON string and store in local storage 
    var pokemonStr = JSON.stringify(pokemon);
    localStorage.setItem("name", pokemonStr);

    readFromLocalStorage();

    return true;

}

//Retrieve local storage that is saved
function readFromLocalStorage() {
    //Retrieving data:
    var storedNameString = localStorage.getItem("name");

    if (storedNameString) {
        var storedName = JSON.parse(storedNameString);

        msg = 'Past Search: <br>';
        msg += 'Welcome ' + storedName.name;

    } else {
        msg = 'No past search';
    }
    
    document.getElementById("pastInfo").innerHTML = msg;
}


function clear() {
    localStorage.removeItem('name');
    readFromLocalStorage();
    document.getElementById('btnReset').click();
    alert('Cleared');
}




</script>

<div id="pastInfo"></div>

</body>
</html>